<div class="p-4 md:p-12 bg-slate-50 min-h-screen pb-20">
  <header class="mb-10 flex flex-col md:flex-row md:items-center justify-between gap-4">
    <div>
      <h2 class="px-4 text-4xl font-serif italic text-slate-900">Appointment History</h2>
      <p class="px-4 text-slate-500 mt-2">View and manage booking records.</p>
    </div>

    <div class="relative">
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">ğŸ”</span>
      <input [(ngModel)]="searchText" (input)="filterResults()"
             placeholder="Search by artist, email, or client..."
             class="p-4 pl-12 rounded-2xl border-none ring-1 ring-slate-200 w-full md:w-80 focus:ring-2 focus:ring-pink-300 transition-all outline-none">
    </div>
  </header>

  <div class="grid grid-cols-1 gap-6">
    <div *ngFor="let appt of filteredAppointments"
         class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 hover:shadow-md transition-shadow">

      <div class="flex-1">
        <div class="flex items-center gap-3 mb-3">
          <span class="font-bold text-xl text-slate-800">{{ appt.serviceName }}</span>
          <span [ngClass]="{
            'bg-green-100 text-green-700': appt.status === 'DONE',
            'bg-pink-100 text-pink-600': appt.status === 'PENDING',
            'bg-slate-100 text-slate-500': appt.status === 'CANCELLED'
          }" class="text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full">
            {{ appt.status }}
          </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-3 text-sm text-slate-500">
          <p class="flex items-center gap-2"><span>ğŸ“…</span> {{ appt.dateTime | date:'EEEE, MMM d, y' }} at {{ appt.dateTime | date:'h:mm a' }}</p>

          <div class="flex items-start gap-2">
            <span>ğŸ‘¤</span>
            <div>
              <p class="text-slate-800 font-medium"><strong>Client:</strong> {{ appt.customerName }}</p>
              <p class="text-xs text-slate-400 lowercase"><strong>Email:</strong> {{ appt.customerEmail }}</p>
              <p class="text-xs text-slate-400 lowercase"><strong>Phone number:</strong> {{ appt.customerPhone }}</p>
            </div>
          </div>

          <p class="flex items-center gap-2"><span>ğŸ¨</span> <strong>Artist:</strong> {{ appt.staffName }}</p>
          <p class="flex items-center gap-2"><span>ğŸ“</span> <strong>Location:</strong> {{ appt.location || 'Studio' }}</p>
        </div>

        <div *ngIf="appt.notes" class="mt-4 p-3 bg-slate-50 rounded-xl border-l-4 border-pink-200 text-xs italic text-slate-600">
          "{{ appt.notes }}"
        </div>
      </div>

      <div *ngIf="(isStaff || isAdmin) && canManage(appt)" class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
        <button *ngIf="appt.status === 'PENDING'"
                (click)="updateStatus(appt.id || appt._id, 'DONE')"
                class="bg-slate-900 text-white px-8 py-3 rounded-2xl text-xs font-bold uppercase tracking-widest hover:bg-slate-800 transition-all active:scale-95 shadow-lg shadow-slate-200">
          Mark Done
        </button>

        <button *ngIf="appt.status === 'PENDING'"
                (click)="updateStatus(appt.id || appt._id, 'CANCELLED')"
                class="bg-white border border-slate-200 text-slate-400 px-8 py-3 rounded-2xl text-xs font-bold uppercase tracking-widest hover:text-red-500 hover:border-red-100 transition-all">
          Cancel
        </button>
      </div>
    </div>

    <div *ngIf="filteredAppointments.length === 0" class="text-center py-20 bg-white rounded-[3rem] border-2 border-dashed border-slate-100">
      <p class="text-slate-400 font-serif italic text-lg">No appointments found matches your search.</p>
    </div>
  </div>
</div>
